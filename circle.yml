---

machine:
  services:
    - docker
    - rabbitmq-server
    
dependencies:
  pre:
    - sudo apt-get update -qq
    - sudo apt-get install -qq python-apt python-pycurl
    - sudo apt-get install aptitude -y
    - sudo ln -s /home/ubuntu/klee-web/ /titb
    - sudo pip install ansible
    - sudo pip install flake8

test:
  pre:
    - echo $VAULT_PASSWORD > /home/ubuntu/.vault_password
  override:
    - flake8 --max-complexity 12 .
    - ansible-playbook -i localhost, --syntax-check --vault-password-file=/home/ubuntu/.vault_password provisioning/vagrant.yml
    - ansible-playbook -i localhost, --connection=local --vault-password-file=/home/ubuntu/.vault_password provisioning/vagrant.yml

deployment:
  staging:
    branch: master
    commands:
      - ansible-playbook -i provisioning/hosts --vault-password-file=/home/ubuntu/.vault_password provisioning/deploy.yml