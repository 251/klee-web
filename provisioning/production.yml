---
# This playbook deploys the whole application stack for icecream

# Apply common configuration to all hosts
- hosts: all
  user: guest
  sudo: yes
  sudo_user: root
  vars_files:
  - vars/secrets.yml
  - vars/production.yml
  roles:
  - common

# Configure and deploy message queue servers.
- hosts: queueservers
  user: guest
  sudo: yes
  sudo_user: root
  vars_files:
    - vars/secrets.yml
    - vars/production.yml
  roles:
  - mq

# Configure and deploy the web servers.
- hosts: webservers
  user: guest
  sudo: yes
  sudo_user: root
  vars_files:
    - vars/secrets.yml
    - vars/production.yml
  roles:
  - web

# Configure and deploy the worker nodes.
- hosts: workers
  user: guest
  sudo: yes
  sudo_user: root
  vars_files:
  - vars/secrets.yml
  - vars/production.yml
  roles:
  - worker
