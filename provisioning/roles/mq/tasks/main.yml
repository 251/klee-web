---

# Add the RabbitMQ repository signing key
- apt_key: url=http://www.rabbitmq.com/rabbitmq-signing-key-public.asc state=present

# Add RabbitMQ debian repository
- apt_repository: repo='deb http://www.rabbitmq.com/debian/ testing main' state=present

# Install RabbitMQ server
- apt: name=rabbitmq-server update_cache=yes state=present

- name: Start RabbitMQ server
  service: name=rabbitmq-server state=started

# Set up rabbitmq vhost
- rabbitmq_vhost: name={{ rabbitmq_vhost }} state=present node=rabbit@{{ ansible_hostname }}

# Set up RabbitMQ user
- rabbitmq_user: user={{ rabbitmq_user }}
                 password={{ rabbitmq_password }}
                 vhost={{ rabbitmq_vhost }}
                 configure_priv=.*
                 read_priv=.*
                 write_priv=.*
                 state=present
                 node=rabbit@{{ ansible_hostname }}